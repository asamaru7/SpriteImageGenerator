"use strict";requirejs.config({baseUrl:"./res/js/",waitSeconds:0,urlArgs:window.cacheBust||(new Date).getTime(),paths:{Knockout:"https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min",Sortable:"https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.2.1/Sortable.min",Masonry:"https://cdnjs.cloudflare.com/ajax/libs/masonry/3.3.1/masonry.pkgd.min",SpriteGenerator:"SpriteImageGenerator",RectanglePacking:"RectanglePacking",FileSaver:"FileSaver.min",JSZip:"https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min"},shim:{}}),$((function(){$('[data-toggle="tooltip"], .pTooltip').tooltip(),$(".cCopy").on("click",(function(){var e=$($(this).data("copy-target"));if(!(e.length<=0)){var t=document.createRange();t.selectNode(e.get(0)),window.getSelection().addRange(t),t=null,e=null;var a=!1;try{a=document.execCommand("copy")}catch(e){}a?alert("복사되었습니다."):alert("정상적으로 복사되지 않았습니다.\n직접 복사하세요."),window.getSelection().removeAllRanges()}})),$("#cSort").find("button").on("click",(function(){var e,t,a=$("#cFiles"),i=a.children(),n=$(this).data("sort-type").split("-");i.sort((e=n[0],t=n[1],function(a,i){var n=$(a).data("sprite-item"),o=$(i).data("sprite-item"),r="asc"===t?1:-1;return"size"===e?(n.width*n.height-o.width*o.height)*r:String(n.name).localeCompare(o.name)*r})),n=null,i.detach().appendTo(a)})),$("#pSettingShowBg").on("click",(function(){var e="y"==$(this).data("is-show");$(this).find("> span").text(e?"Show Background":"Hide Background"),$(this).data("is-show",e?"n":"y"),e?$("#cFiles").removeClass("cShowBG"):$("#cFiles").addClass("cShowBG")}))})),require(["SpriteGenerator"],(function(e){var t=new e({onFileAdded:function(e){var t=$("#pWidth");(parseInt(t.val())||0)<e.width&&t.val(e.width);var a=$("#pHeight");(parseInt(a.val())||0)<e.height&&a.val(e.height)},onValidation:function(e){$("#cValidation").empty().append(e),require(["Masonry"],(function(e){new e("#cValidation ul",{itemSelector:"li"})}))},filesElement:$("#files"),dropElement:$("#cFiles")}),a=function(){var e=parseInt($("#pPaddingHor").val())||0,t=parseInt($("#pPaddingVer").val())||0;return{retina:$("#resample").prop("checked"),useCr:$("#useCr").prop("checked"),useDataUrl:$("#useDataUrl").prop("checked"),fixedSize:$("#fixedSize").prop("checked"),width:parseInt($("#pWidth").val()),height:parseInt($("#pHeight").val()),padding:{top:t,right:e,bottom:t,left:e},layout:$("[name=layout]:checked").val(),className:$("#pClassName").val(),prefix:$("#pPrefix").val(),filename:$("#pFileName").val(),urlPrefix:$("#pUrlPrefix").val()}};$("#cResultTab, #cValidationTab, #cExportTab").on("show.bs.tab",(function(e){var i=t.generate(a());if(null==i)return e.preventDefault(),!1;var n=i.css.common+"\n"+i.css.each;n=n.replace(/\n/g,"<br />").replace(/\t/g,"&nbsp;&nbsp;");var o=$(".cResultBox").empty();o.append('<pre class="generated-css">'+n+"</pre>");var r=document.createElement("style");switch(r.innerHTML=i.css.validation,o.append(r),r=null,o=null,$(e.target).attr("id")){case"cResultTab":break;case"cExportTab":var l=t.export(a(),!0);$(".cExportData").empty().html(l.setting);var p=$("#cExport");l.data.option.filename,p.find(".pNormal, .pRetina").empty(),l.normal&&(p.find(".pNormalTitle").html(t.getFileName(!1)),p.find(".pNormal").html('<img src="'+l.normal+'" alt="normal"/>')),l.retina&&(p.find(".pRetinaTitle").html(t.getFileName(!0)),p.find(".pRetina").html('<img src="'+l.retina+'" alt="retina"/>')),p.find(".cJsonTitle").html(t.getJsonFileName()),l=null,p=null}})),function(){function e(e){try{var a=JSON.parse(e);$("#resample").prop("checked",a.option.retina),$("#useCr").prop("checked",a.option.useCr),$("#fixedSize").prop("checked",a.option.fixedSize),$("#pWidth").val(a.option.width),$("#pHeight").val(a.option.height),$("#pPaddingHor").val(a.option.padding.left),$("#pPaddingVer").val(a.option.padding.top),$(":radio[value="+a.option.layout+"]").prop("checked",!0),$("#pClassName").val(a.option.className),$("#pPrefix").val(a.option.prefix),$("#pFileName").val(a.option.filename),$("#useDataUrl").prop("checked",a.option.useDataUrl),$("#pUrlPrefix").val(a.option.urlPrefix),t.replaceFiles(a.files),$(".cImportBox").modal("hide")}catch(e){}}require(["Knockout"],(function(e){var t={fixedSize:e.observable($("#fixedSize").prop("checked")),useDataUrl:e.observable($("#useDataUrl").prop("checked"))};e.applyBindings(t,$("#cSetting").get(0)),t=null})),$("#pImport").on("dragover",(function(e){e.stopPropagation(),e.preventDefault(),$(this).removeClass("btn-default").addClass("btn-success")})).on("dragleave",(function(e){e.stopPropagation(),e.preventDefault(),$(this).removeClass("btn-success").addClass("btn-default")})).on("drop",(function(t){t.stopPropagation(),t.preventDefault(),$(this).trigger("dragleave");var a=t.originalEvent,i=a.target.files||a.dataTransfer.files;if(i.length>1)alert("한개의 파일만 Import 가능합니다.");else{var n=i[0];if(n.type.match("application/json*")){var o=new FileReader;o.onload=function(t){e(String(t.target.result).replace(/^data:application\/(json);base64,/,""))},o.readAsText(n),o=null}}})),$("#pImportOk").on("click",(function(){e($("#cImportTextarea").val())})),$("#pGenerate").on("submit",(function(e){e.preventDefault(),$("#cResultTab").tab("show")}))}(),$("#pShowBg").on("click",(function(){var e="y"===$(this).data("is-show");$(this).find("> span").text(e?"Show Background":"Hide Background"),$(this).data("is-show",e?"n":"y"),e?$("#cExport").removeClass("cShowBG"):$("#cExport").addClass("cShowBG")})),$("#pExportDown").on("click",(function(){t.exportToZip(a())}))}));
